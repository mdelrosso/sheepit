!function(e){jQuery.fn.sheepIt=function(t){function n(){var e;return"function"==typeof t.beforeClone&&t.beforeClone(rt,lt),e=lt.cloneWithAttribut(!0),"function"==typeof t.afterClone&&t.afterClone(rt,e),e.getSource=function(){return rt},e}function r(e){e.preventDefault(),F()}function o(e){e.preventDefault(),""!==at.value&&C(at.attr("value"))}function i(n){n.preventDefault(),"function"==typeof t.beforeRemoveCurrent&&t.beforeRemoveCurrent(rt),t.removeCurrentConfirmation?confirm(t.removeCurrentConfirmationMsg)&&y(e(this).data("removableClone")):y(e(this).data("removableClone")),"function"==typeof t.afterRemoveCurrent&&t.afterRemoveCurrent(rt)}function a(e){e.preventDefault(),t.removeLastConfirmation?confirm(t.removeLastConfirmationMsg)&&x():x()}function u(e){e.preventDefault(),t.removeAllConfirmation?confirm(t.removeAllConfirmationMsg)&&g():g()}function f(e,t){var n=e.attr(t+"template");if(n)return unescape(n);var r=e.attr(t);return e.attr(t+"template",escape(r)),r}function d(n,r){n.find(vt).each(function(){{var o=e(this),i=f(o,"id"),a=f(o,"name"),u=o.attr("id");o.attr("name")}newNameAttr=a.replace(t.indexFormat,r),o.attr("name",newNameAttr),newIdAttr=i.replace(t.indexFormat,r),n.find("label[for='"+u+"']").each(function(){e(this).attr("for",newIdAttr)}),o.attr("id",newIdAttr)})}function s(e,t){m(e,t+1)}function m(e,n){return e.find(t.labelSelector).html(n),!0}function l(e){return e.find(t.labelSelector).html()}function c(){if(P()){1==M()?(st.hideIf(),ft.showIf()):(st.showIf(),ft.showIf());var e="";t.allowRemoveCurrent?(e=rt.find(t.removeCurrentSelector),z()?e.show():e.hide()):(e=rt.find(t.removeCurrentSelector),e.hide())}else ft.hideIf(),st.hideIf();q()?(ot.showIf(),it.showIf()):(ot.hideIf(),it.hideIf()),z()||(ft.hideIf(),st.hideIf()),"none"!=ot.css("display")||"none"!=it.css("display")||"none"!=st.css("display")||"none"!=ft.css("display")?mt.show():mt.hide()}function p(){if(P()){if(pt.hide(),t.continuousIndex){var e=0,n=O();do v(n,e),e++,n=Q(n);while(0!=n)}}else pt.show()}function v(e,n){"undefined"==typeof n&&(n=k());var r=f(e,"id");if(e.attr("id")&&e.attr("id",r+n),d(e,n),s(e,n),-1!=e.html().indexOf(t.indexFormat)){var o=new RegExp(t.indexFormat,"ig");e.html(e.html().replace(o,n))}var i=e.find(t.removeCurrentSelector);return t.allowRemoveCurrent?i.show():i.hide(),e}function h(){p(),c()}function F(r,o){"undefined"==typeof r&&(r=!0),"undefined"==typeof o&&(o=!1),"function"==typeof t.beforeAdd&&t.beforeAdd(rt);var a=!1;if(o){if("string"==typeof o)a=e("#"+o);else{if("object"!=typeof o)return!1;a=o}a.remove()}else a=n();if(q()&&a){a=v(a);var u=a.find(t.removeCurrentSelector).first();if(u.click(i),u.data("removableClone",a),a.data("formIndex",k()),a.data("previousSeparator",!1),a.data("nextSeparator",!1),a.data("previousForm",!1),a.data("nextForm",!1),P()){var f=D();if(f.data("nextForm",a),a.data("previousForm",f),t.separator){var d=V();d.insertAfter(f),f.data("nextSeparator",d),a.data("previousSeparator",d)}}if("after"==t.insertNewForms?a.insertBefore(pt):a.insertAfter(pt),t.nestedForms.length>0){var s=0,m=[];for(s in t.nestedForms)if("undefined"!=typeof t.nestedForms[s].id&&"undefined"!=typeof t.nestedForms[s].options){t.nestedForms[s].isNestedForm=!0,t.nestedForms[s].parentForm=rt;var l=t.nestedForms[s].id.replace(t.indexFormat,a.data("formIndex")),c=e("#"+l).sheepIt(t.nestedForms[s].options);m.push(c)}a.data("nestedForms",m)}return tt(a),ht.push(a),(r||t.continuousIndex)&&h(),"function"==typeof t.afterAdd&&t.afterAdd(rt,a),!0}return!1}function C(e,t){if("undefined"!=typeof e){e=parseFloat(e);var n=1;for(n=1;e>=n;n++)F(t)}}function x(e){return"undefined"==typeof e&&(e=!0),z()?(S(),e&&h(),!0):!1}function g(e){if("undefined"==typeof e&&(e=!0),G()){var t=[];for(t in ht)ht[t]&&S(ht[t]);return e&&h(),!0}return!1}function y(e,t){return"undefined"==typeof t&&(t=!0),z()?(S(e),t&&h(),!0):!1}function S(e){return"undefined"==typeof e&&(e=D()),index=e.data("formIndex"),e.data("previousSeparator")&&e.data("nextSeparator")?(e.data("previousSeparator").remove(),e.data("previousForm").data("nextSeparator",e.data("nextSeparator"))):e.data("previousSeparator")&&!e.data("nextSeparator")?(e.data("previousSeparator").remove(),e.data("previousForm").data("nextSeparator",!1)):!e.data("previousSeparator")&&e.data("nextSeparator")&&(e.data("nextSeparator").remove(),e.data("nextForm").data("previousSeparator",!1)),e.data("previousForm")&&e.data("previousForm").data("nextForm",e.data("nextForm")),e.data("nextForm")&&e.data("nextForm").data("previousForm",e.data("previousForm")),ht[index]=!1,e.remove(),!0}function A(){return Ft}function w(){if(Ft!==!1){if(ht.length>1){var e=0,t=parseFloat(Ft+1);for(e=t;e<ht.length;e++)if(ht[e])return Ft=e,!0;return!1}return!1}return!1}function b(){if(Ft!==!1){if(ht.length>1){var e=0,t=parseFloat(Ft-1);for(e=t;e>=0;e--)if(ht[e])return Ft=e,!0;return!1}return!1}return!1}function I(){if(Ft=!1,ht.length>0){var e=0;for(e in ht)if(ht[e])return Ft=e,!0;return!1}return!1}function _(){if(Ft=!1,ht.length>0){if(ht[ht.length-1])return Ft=ht.length-1,!0;var e=0;for(e=ht.length-1;e>=0;e--)if(ht[e])return Ft=e,!0;return!1}return!1}function N(){if(ht.length>0){var e=0,t=[];for(t in ht)ht[t]&&e++;return e}return 0}function R(e){return"undefined"!=typeof e?(Ft=L(e),Ft!==!1?!0:!1):!1}function L(e){var t=0,n=0,r=!1;for(t in ht)ht[t]&&(n++,e==n&&(r=t));return r}function j(e){var t=0,n=0;for(t=0;e>=t;t++)ht[t]&&n++;return n}function k(){return ht.length}function M(){return N()}function O(){return I()!==!1?B():!1}function D(){return _()!==!1?B():!1}function Q(e){return e?e.data("nextForm"):A()!==!1&&w()!==!1?B():!1}function T(e){return e?e.data("previousForm"):A()!==!1&&b()!==!1?B():!1}function B(){return A()!==!1?ht[A()]:!1}function W(e){return P()?"undefined"!=typeof e?(R(e),B()):D():!1}function E(){if(P()){I();var e=0,t=[];for(e=0;e<M();e++)t.push(B()),w();return t}return!1}function P(){return M()>0?!0:!1}function q(){return 0==t.maxFormsCount?!0:M()<t.maxFormsCount?!0:!1}function z(){return M()>t.minFormsCount?!0:!1}function G(){return 0==t.minFormsCount?!0:!1}function H(n,r){var o="";"number"==typeof n?(n++,n>M()&&F(),o=W(n),J(o,r)):"string"==typeof n&&(o=e("#"+n),J(o,r)),"function"==typeof t.afterFill&&t.afterFill(rt,o,r)}function J(t,n){var r=0;e.each(n,function(e,n){var o=rt.attr("id"),i=t.data("formIndex");-1!=e.indexOf("#form#")||-1!=e.indexOf("#index#")?(e=e.replace("#form#",o),e=e.replace("#index#",i)):e=o+"_"+i+"_"+e;var a=t.find(':input[id="'+e+'"]');if(0==a.length&&(a=t.find(':input[name="'+e+'"]'),0==a.length&&(a=t.find(':input[name="'+e+'[]"]'))),a.length>0){var u=!1;"object"==typeof n&&(u=!0);var f=!1;if(a.length>1&&(f=!0),f)if(u){var d=[];d.fields=[],d.values=[],r=0;for(r in n)d.fields.push(a.filter('[value="'+n[r]+'"]')),d.values.push(n[r]);r=0;for(r in d.fields)K(d.fields[r],d.values[r])}else K(a.filter('[value="'+n+'"]',n));else if(u){r=0;for(r in n)K(a,n[r])}else K(a,n)}else if("undefined"!=typeof t.data("nestedForms")&&t.data("nestedForms").length>0){r=0;for(r in t.data("nestedForms"))e==t.data("nestedForms")[r].attr("id")&&"object"==typeof n&&t.data("nestedForms")[r].inject(n)}})}function K(t,n){var r=t.attr("type");return"text"==r||"hidden"==r||"password"==r||"number"==r||"date"==r?(t.attr("value",n),!0):"textarea"==r?(t.text(n),!0):"checkbox"==r||"radio"==r?(t.attr("checked","checked"),!0):"select-one"==r||"select-multiple"==r?(t.find("option").each(function(){(e(this).text()==n||e(this).attr("value")==n)&&e(this).attr("selected","selected")}),!0):!1}function U(){return""!=t.separator?!0:!1}function V(){return U()?e(t.separator):!1}function X(n){t=[],t=e.extend(Ct,n),nt(t)}function Y(){return t}function Z(){rt.hide(),ot=e(t.addSelector),it=e(t.addNSelector),at=e(t.addNInputSelector),ut=e(t.addNButtonSelector),ft=e(t.removeLastSelector),dt=e(t.removeCurrentSelector),st=e(t.removeAllSelector),mt=e(t.controlsSelector),0==ot.length&&(t.allowAdd=!1),0==it.length&&(t.allowAddN=!1),0==ft.length&&(t.allowRemoveLast=!1),0==st.length&&(t.allowRemoveAll=!1),$(ot,t.allowAdd,r),$(it,t.allowAddN,o,ut),$(ft,t.allowRemoveLast,a),$(st,t.allowRemoveAll,u),ot.init(),it.init(),ft.init(),st.init(),ct=e(t.formTemplateSelector),pt=e(t.noFormsTemplateSelector),lt=ct.cloneWithAttribut(!0),ct.remove();var n=0;if(t.pregeneratedForms.length>0){n=0;for(n in t.pregeneratedForms)F(!1,t.pregeneratedForms[n])}if(t.iniFormsCount>M()){n=0;var i=t.iniFormsCount-M();for(n=1;i>=n;n++)F(!1)}t.data&&rt.inject(t.data),h(),rt.show()}function $(t,n,r,o){"undefined"==typeof o&&(o=!1),e.extend(t,{hideIf:function(e,r){n&&t.hide(e,r)},showIf:function(e,r){n&&t.show(e,r)},init:function(){n?(o?o.click(r):t.click(r),t.show()):t.hide()}})}function et(n){e.extend(n,{getAddControl:function(){return ot},getAddNControl:function(){return it},getRemoveLastControl:function(){return ft},getRemoveAllControl:function(){return st},getOptions:function(){return Y()},getOption:function(e){return t[e]},setOption:function(e,n){return"undefined"!=typeof e&&"undefined"!=typeof n?(t[e]=n,t[e]):!1},getForms:function(){return E()},getAllForms:function(){return E()},getForm:function(e){return"undefined"!=typeof e&&e++,W(e)},getLastForm:function(){return W()},getFirstForm:function(){return I(),B()},addForm:function(){return F()},addNForms:function(e){return C(e)},getFormsCount:function(){return M()},hasForms:function(){return P()},canAddForm:function(){return q()},canRemoveAllForms:function(){return G()},canRemoveForm:function(){return z()},removeAllForms:function(){return g()},removeLastForm:function(){return x()},removeFirstForm:function(){return I(),S(B())},removeForm:function(e){return"undefined"!=typeof e&&e++,S(W(e))},inject:function(t){e.each(t,e.proxy(H,n))}})}function tt(t){e.extend(t,{setLabel:function(e){return m(t,e)},getLabel:function(){return l(t)},inject:function(e){J(t,e)},getNestedForms:function(){return t.data("nestedForms")},getNestedForm:function(e){return t.data("nestedForms")[e]},getPosition:function(){return j(t.data("formIndex"))},getPreviousForm:function(){return T(t)},getNextForm:function(){return Q(t)},removeForm:function(){return S(t)}})}function nt(e){e.maxFormsCount>0?(e.maxFormsCount<e.minFormsCount&&(e.maxFormsCount=e.minFormsCount),(e.iniFormsCount<e.minFormsCount||e.iniFormsCount>e.maxFormsCount)&&(e.iniFormsCount=e.minFormsCount)):e.iniFormsCount<e.minFormsCount&&(e.iniFormsCount=e.minFormsCount),G()||(e.allowRemoveAll=!1)}var rt=e(this).first();et(rt);var ot,it,at,ut,ft,dt,st,mt,lt,ct,pt,vt="input, checkbox, select, textarea",ht=[],Ft=!1,Ct={addSelector:"#"+e(this).attr("id")+"_add",addNSelector:"#"+e(this).attr("id")+"_add_n",addNInputSelector:"#"+e(this).attr("id")+"_add_n_input",addNButtonSelector:"#"+e(this).attr("id")+"_add_n_button",removeLastSelector:"#"+e(this).attr("id")+"_remove_last",removeCurrentSelector:"#"+e(this).attr("id")+"_remove_current",removeAllSelector:"#"+e(this).attr("id")+"_remove_all",controlsSelector:"#"+e(this).attr("id")+"_controls",labelSelector:"#"+e(this).attr("id")+"_label",allowRemoveLast:!0,allowRemoveCurrent:!0,allowRemoveAll:!1,allowAdd:!0,allowAddN:!1,removeLastConfirmation:!1,removeCurrentConfirmation:!1,removeAllConfirmation:!0,removeLastConfirmationMsg:"Are you sure?",removeCurrentConfirmationMsg:"Are you sure?",removeAllConfirmationMsg:"Are you sure?",formTemplateSelector:"#"+e(this).attr("id")+"_template",noFormsTemplateSelector:"#"+e(this).attr("id")+"_noforms_template",separator:'<div style="width:100%; border-top:1px solid #ff0000; margin: 10px 0px;"></div>',iniFormsCount:1,maxFormsCount:20,minFormsCount:1,incrementCount:1,noFormsMsg:"No forms to display",indexFormat:"#index#",data:[],pregeneratedForms:[],nestedForms:[],isNestedForm:!1,parentForm:{},beforeClone:function(){},afterClone:function(){},beforeAdd:function(){},afterAdd:function(){},afterFill:function(){},afterRemoveCurrent:function(){},beforeRemoveCurrent:function(){},insertNewForms:"after",continuousIndex:!0};return X(t),Z(),rt},jQuery.fn.cloneWithAttribut=function(t){if(jQuery.support.noCloneEvent)return e(this).clone(t);e(this).find("*").each(function(){e(this).data("name",e(this).attr("name"))});var n=e(this).clone(t);return n.find("*").each(function(){e(this).attr("name",e(this).data("name"))}),n}}(jQuery);